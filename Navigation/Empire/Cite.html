<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMPERIUM - Ma Cit√© Romaine</title>
    <meta name="description" content="G√©rez votre cit√© romaine dans IMPERIUM - Construisez, d√©veloppez, prosp√©rez.">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23b45309'/><text x='16' y='20' text-anchor='middle' fill='white' font-family='serif' font-size='20' font-weight='bold'>I</text></svg>" type="image/svg+xml">

    <!-- Styles et scripts communs -->
    <link rel="stylesheet" href="../common-styles.css">
    <script src="../common-navigation.js"></script>
    <script src="../game-engine.js"></script>
    <script src="../advanced-game-systems.js"></script>
    <script src="../save-system.js"></script>
    <script src="../ui-manager.js"></script>
    <script src="../global-console.js"></script>

    <style>
        /* Styles sp√©cifiques √† la cit√© romaine */
        :root {
            --roman-red: #8B0000;
            --roman-gold: #FFD700;
            --roman-bronze: #CD7F32;
            --roman-marble: #F8F8FF;
            --roman-stone: #696969;
            --roman-purple: #800080;
        }

        .city-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            height: calc(100vh - 200px);
        }

        /* === CARTE DE LA CIT√â === */
        .city-map-container {
            background: linear-gradient(135deg, 
                rgba(139, 0, 0, 0.1) 0%, 
                rgba(205, 127, 50, 0.1) 50%, 
                rgba(255, 215, 0, 0.1) 100%);
            border-radius: 1.5rem;
            border: 3px solid var(--roman-bronze);
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .city-map-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="marble" patternUnits="userSpaceOnUse" width="20" height="20"><rect width="20" height="20" fill="%23f8f8ff" opacity="0.05"/><path d="M0,20 L20,0 M-5,5 L5,-5 M15,25 L25,15" stroke="%23ddd" stroke-width="0.5" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23marble)"/></svg>') repeat;
            pointer-events: none;
            z-index: 0;
        }

        .city-title {
            color: var(--roman-gold);
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            font-family: 'Times New Roman', serif;
            position: relative;
            z-index: 1;
        }

        .city-title::before {
            content: 'üèõÔ∏è';
            margin-right: 1rem;
        }

        .city-title::after {
            content: 'üèõÔ∏è';
            margin-left: 1rem;
        }

        .buildings-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 0.5rem;
            height: 500px;
            background: radial-gradient(circle at center, 
                rgba(255, 215, 0, 0.1) 0%, 
                rgba(139, 0, 0, 0.05) 100%);
            border-radius: 1rem;
            padding: 1rem;
            border: 2px solid var(--roman-bronze);
            position: relative;
            z-index: 1;
        }

        .building-slot {
            background: linear-gradient(135deg, 
                rgba(248, 248, 255, 0.1) 0%, 
                rgba(205, 127, 50, 0.1) 100%);
            border: 2px dashed var(--roman-stone);
            border-radius: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .building-slot:hover {
            border-color: var(--roman-gold);
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.2) 0%, 
                rgba(139, 0, 0, 0.1) 100%);
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }

        .building-slot.occupied {
            border: 2px solid var(--roman-bronze);
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.2) 0%, 
                rgba(205, 127, 50, 0.2) 100%);
        }

        .building-slot.occupied:hover {
            border-color: var(--roman-gold);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }

        .building-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }

        .building-name {
            color: var(--roman-marble);
            font-weight: bold;
            font-size: 0.8rem;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            font-family: 'Times New Roman', serif;
        }

        .building-level {
            color: var(--roman-gold);
            font-size: 0.7rem;
            font-weight: bold;
            margin-top: 0.2rem;
        }

        .building-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .building-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--roman-gold), var(--roman-bronze));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* === PANNEAU DE CONTR√îLE === */
        .city-control-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .panel-section {
            background: linear-gradient(135deg, 
                rgba(139, 0, 0, 0.1) 0%, 
                rgba(0, 0, 0, 0.3) 100%);
            border: 2px solid var(--roman-bronze);
            border-radius: 1rem;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .section-title {
            color: var(--roman-gold);
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-align: center;
            font-family: 'Times New Roman', serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .section-title::before {
            content: '‚öúÔ∏è ';
        }

        .section-title::after {
            content: ' ‚öúÔ∏è';
        }

        /* Statistiques de la cit√© */
        .city-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--roman-bronze);
        }

        .stat-value {
            color: var(--roman-gold);
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.3rem;
        }

        .stat-label {
            color: var(--roman-marble);
            font-size: 0.9rem;
            font-family: 'Times New Roman', serif;
        }

        .stat-icon {
            font-size: 1.2rem;
            margin-right: 0.5rem;
        }

        /* Production en temps r√©el */
        .production-display {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .production-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.5rem;
            padding: 0.8rem;
            border: 1px solid var(--roman-bronze);
        }

        .production-resource {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--roman-marble);
            font-weight: bold;
        }

        .production-rate {
            color: var(--roman-gold);
            font-weight: bold;
        }

        .production-rate.positive {
            color: #22c55e;
        }

        .production-rate.negative {
            color: #dc2626;
        }

        /* Files d'attente */
        .queue-container {
            max-height: 200px;
            overflow-y: auto;
        }

        .queue-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.8rem;
            border: 1px solid var(--roman-bronze);
            position: relative;
        }

        .queue-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .queue-item-name {
            color: var(--roman-gold);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .queue-item-time {
            color: var(--roman-marble);
            font-size: 0.9rem;
        }

        .queue-progress {
            height: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .queue-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--roman-gold), var(--roman-bronze));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Actions rapides */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .quick-action-btn {
            background: linear-gradient(135deg, var(--roman-red), var(--roman-bronze));
            color: var(--roman-marble);
            border: 2px solid var(--roman-gold);
            border-radius: 0.8rem;
            padding: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Times New Roman', serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
            border-color: var(--roman-marble);
        }

        .quick-action-btn:active {
            transform: translateY(0);
        }

        /* Stockage avec barres visuelles */
        .storage-display {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .storage-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.5rem;
            padding: 1rem;
            border: 1px solid var(--roman-bronze);
        }

        .storage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .storage-resource {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--roman-marble);
            font-weight: bold;
        }

        .storage-amount {
            color: var(--roman-gold);
            font-weight: bold;
        }

        .storage-bar {
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .storage-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                #22c55e 0%, 
                #eab308 70%, 
                #dc2626 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .city-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .buildings-grid {
                height: 400px;
            }
            
            .building-icon {
                font-size: 2rem;
            }
            
            .city-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Animations sp√©ciales */
        @keyframes roman-glow {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); 
            }
            50% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); 
            }
        }

        .building-slot.constructing {
            animation: roman-glow 2s infinite;
        }

        @keyframes resource-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .production-rate.positive {
            animation: resource-pulse 2s infinite;
        }

        /* Effets de particules pour les b√¢timents actifs */
        .building-slot.active::after {
            content: '‚ú®';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1rem;
            animation: sparkle 3s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Particules d'arri√®re-plan -->
    <div class="particles"></div>

    <!-- INTERFACE PRINCIPALE DU JEU -->
    <div class="imperium-ui">
        <!-- HEADER -->
        <header class="imperium-header">
            <div class="header-content">
                <h1 class="imperium-logo">IMPERIUM</h1>
                <div id="resources-display" class="resources-display">
                    <!-- Les ressources seront inject√©es ici par JS -->
                </div>
                <div class="player-info">
                    <div class="player-avatar" id="player-avatar">üèõÔ∏è</div>
                    <div>
                        <div class="player-name" id="player-name"></div>
                        <div class="player-level" id="player-title-level"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- CORPS PRINCIPAL -->
        <div class="imperium-body">
            <!-- BARRE LATERALE (Desktop) -->
            <aside class="imperium-sidebar">
                <!-- Navigation g√©n√©r√©e dynamiquement par common-navigation.js -->
            </aside>

            <!-- CONTENU PRINCIPAL -->
            <main class="main-content">
                <div class="view-container">
                    <div class="city-layout">
                        <!-- Carte de la cit√© -->
                        <div class="city-map-container">
                            <h2 class="city-title" id="city-name">Ma Cit√© Romaine</h2>
                            <div class="buildings-grid" id="buildings-grid">
                                <!-- G√©n√©r√© par JavaScript -->
                            </div>
                        </div>

                        <!-- Panneau de contr√¥le -->
                        <div class="city-control-panel">
                            <!-- Statistiques de la cit√© -->
                            <div class="panel-section">
                                <h3 class="section-title">üìä Statistiques de la Cit√©</h3>
                                <div class="city-stats" id="city-stats">
                                    <div class="stat-item">
                                        <div class="stat-value" id="population-current">2,450</div>
                                        <div class="stat-label">
                                            <span class="stat-icon">üë•</span>Citoyens
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="happiness-level">85%</div>
                                        <div class="stat-label">
                                            <span class="stat-icon">üòä</span>Bonheur
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="buildings-count">18</div>
                                        <div class="stat-label">
                                            <span class="stat-icon">üèõÔ∏è</span>B√¢timents
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="military-power">3,250</div>
                                        <div class="stat-label">
                                            <span class="stat-icon">‚öîÔ∏è</span>Puissance Militaire
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Production en temps r√©el -->
                            <div class="panel-section">
                                <h3 class="section-title">‚ö° Production par Heure</h3>
                                <div class="production-display" id="production-display">
                                    <!-- G√©n√©r√© par JavaScript -->
                                </div>
                            </div>

                            <!-- Stockage des ressources -->
                            <div class="panel-section">
                                <h3 class="section-title">üè™ Entrep√¥ts</h3>
                                <div class="storage-display" id="storage-display">
                                    <!-- G√©n√©r√© par JavaScript -->
                                </div>
                            </div>

                            <!-- Files d'attente -->
                            <div class="panel-section">
                                <h3 class="section-title">üî® Construction en Cours</h3>
                                <div class="queue-container" id="construction-queue">
                                    <!-- G√©n√©r√© par JavaScript -->
                                </div>
                            </div>

                            <!-- Actions rapides -->
                            <div class="panel-section">
                                <h3 class="section-title">‚ö° Actions Rapides</h3>
                                <div class="quick-actions">
                                    <button class="quick-action-btn" onclick="quickCollectTaxes()">
                                        üí∞ Collecter Imp√¥ts
                                    </button>
                                    <button class="quick-action-btn" onclick="quickRecruitUnits()">
                                        ‚öîÔ∏è Recruter Soldats
                                    </button>
                                    <button class="quick-action-btn" onclick="quickBoostProduction()">
                                        ‚ö° Booster Production
                                    </button>
                                    <button class="quick-action-btn" onclick="quickCelebrateFestival()">
                                        üé≠ Organiser Festival
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Console flottante (sera ajout√©e par JavaScript) -->
    <div id="floating-console" class="floating-console">
        <!-- Contenu g√©n√©r√© par JavaScript -->
    </div>

    <script>
        // Variables globales
        let uiManager;
        let buildingSlots = [];
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser le moteur de jeu s'il n'est pas d√©j√† initialis√©
            if (!gameEngine.isRunning) {
                gameEngine.init();
            }
            
            // Initialiser le gestionnaire d'interface
            uiManager = new ImperiumUIManager(gameEngine);
            
            // G√©n√©rer la grille de b√¢timents
            generateBuildingsGrid();
            
            // Mettre √† jour l'interface
            updateCityInterface();
            
            // D√©marrer les mises √† jour en temps r√©el
            setInterval(updateCityInterface, 1000);
            
            console.log('üèõÔ∏è Cit√© romaine initialis√©e!');
        });
        
        // G√©n√©ration de la grille de b√¢timents (6x6)
        function generateBuildingsGrid() {
            const grid = document.getElementById('buildings-grid');
            const gameState = gameEngine.getGameState();
            const city = gameState.cities.main;
            
            // Cr√©er 36 emplacements (6x6)
            for (let i = 0; i < 36; i++) {
                const slot = document.createElement('div');
                slot.className = 'building-slot';
                slot.dataset.slotId = i;
                
                // V√©rifier s'il y a un b√¢timent √† cet emplacement
                const building = city.buildings[`slot_${i}`];
                
                if (building) {
                    const config = BUILDINGS_CONFIG[building.type];
                    slot.classList.add('occupied');
                    if (building.level > 0) {
                        slot.classList.add('active');
                    }
                    
                    slot.innerHTML = `
                        <div class="building-icon">${config.icon}</div>
                        <div class="building-name">${config.name}</div>
                        <div class="building-level">Niveau ${building.level}</div>
                        <div class="building-progress">
                            <div class="building-progress-bar" style="width: 0%"></div>
                        </div>
                    `;
                } else {
                    slot.innerHTML = `
                        <div class="building-icon">üèóÔ∏è</div>
                        <div class="building-name">Terrain Vacant</div>
                        <div class="building-level">Construire</div>
                    `;
                }
                
                // Ajouter l'√©v√©nement de clic
                slot.addEventListener('click', () => handleBuildingClick(i, building));
                
                grid.appendChild(slot);
                buildingSlots.push(slot);
            }
        }
        
        // Gestion des clics sur les b√¢timents
        function handleBuildingClick(slotId, building) {
            if (building) {
                // B√¢timent existant - options d'am√©lioration
                showBuildingUpgradeModal(slotId, building);
            } else {
                // Terrain vacant - options de construction
                showBuildingConstructionModal(slotId);
            }
        }
        
        function showBuildingConstructionModal(slotId) {
            const availableBuildings = Object.keys(BUILDINGS_CONFIG).filter(type => {
                const config = BUILDINGS_CONFIG[type];
                return gameEngine.canBuild(type, 1);
            });
            
            if (availableBuildings.length === 0) {
                uiManager.showNotification('Construction', 'Aucun b√¢timent disponible pour le moment', 'warning');
                return;
            }
            
            const buildingOptions = availableBuildings.map(type => {
                const config = BUILDINGS_CONFIG[type];
                const cost = gameEngine.calculateBuildingCost(type, 1);
                const costText = Object.keys(cost).map(resource => 
                    `${cost[resource]} ${RESOURCES_CONFIG[resource].icon}`
                ).join(' ');
                
                return `
                    <div class="building-option" onclick="constructBuilding('${slotId}', '${type}')">
                        <div class="building-option-icon">${config.icon}</div>
                        <div class="building-option-name">${config.name}</div>
                        <div class="building-option-cost">${costText}</div>
                        <div class="building-option-desc">${config.description}</div>
                    </div>
                `;
            }).join('');
            
            uiManager.showModal('Construire un B√¢timent', `
                <div class="building-selection">
                    ${buildingOptions}
                </div>
            `);
        }
        
        function showBuildingUpgradeModal(slotId, building) {
            const config = BUILDINGS_CONFIG[building.type];
            const nextLevel = building.level + 1;
            const canUpgrade = gameEngine.canBuild(building.type, nextLevel);
            const cost = gameEngine.calculateBuildingCost(building.type, nextLevel);
            
            const costText = Object.keys(cost).map(resource => 
                `${cost[resource]} ${RESOURCES_CONFIG[resource].icon}`
            ).join(' ');
            
            uiManager.showModal(`${config.name} - Niveau ${building.level}`, `
                <div class="building-details">
                    <div class="building-icon-large">${config.icon}</div>
                    <div class="building-info">
                        <p><strong>Description:</strong> ${config.description}</p>
                        <p><strong>Niveau actuel:</strong> ${building.level}</p>
                        <p><strong>Production actuelle:</strong> ${gameEngine.calculateBuildingProduction(building.type, building.level)}/h</p>
                        ${canUpgrade ? `
                            <p><strong>Co√ªt d'am√©lioration:</strong> ${costText}</p>
                            <button class="upgrade-btn" onclick="upgradeBuilding('${slotId}', '${building.type}')">
                                ‚¨ÜÔ∏è Am√©liorer au niveau ${nextLevel}
                            </button>
                        ` : `
                            <p style="color: #dc2626;">Am√©lioration impossible (ressources insuffisantes ou niveau max atteint)</p>
                        `}
                    </div>
                </div>
            `);
        }
        
        // Actions de construction et d'am√©lioration
        function constructBuilding(slotId, buildingType) {
            try {
                gameEngine.startConstruction(buildingType, 1, `slot_${slotId}`);
                uiManager.closeModal();
                uiManager.showNotification('Construction', `Construction de ${BUILDINGS_CONFIG[buildingType].name} commenc√©e!`, 'success');
                updateCityInterface();
            } catch (error) {
                uiManager.showNotification('Erreur', error.message, 'error');
            }
        }
        
        function upgradeBuilding(slotId, buildingType) {
            try {
                const gameState = gameEngine.getGameState();
                const building = gameState.cities.main.buildings[`slot_${slotId}`];
                gameEngine.startConstruction(buildingType, building.level + 1, `slot_${slotId}`);
                uiManager.closeModal();
                uiManager.showNotification('Am√©lioration', `Am√©lioration de ${BUILDINGS_CONFIG[buildingType].name} commenc√©e!`, 'success');
                updateCityInterface();
            } catch (error) {
                uiManager.showNotification('Erreur', error.message, 'error');
            }
        }
        
        // Mise √† jour de l'interface de la cit√©
        function updateCityInterface() {
            updateCityStats();
            updateProductionDisplay();
            updateStorageDisplay();
            updateConstructionQueue();
            updateBuildingSlots();
        }
        
        function updateCityStats() {
            const gameState = gameEngine.getGameState();
            const city = gameState.cities.main;
            
            // Calculer les statistiques
            const population = gameEngine.calculatePopulation();
            const happiness = gameEngine.calculateHappiness();
            const buildingsCount = Object.keys(city.buildings).length;
            const militaryPower = gameEngine.calculateMilitaryPower();
            
            // Mettre √† jour l'affichage
            document.getElementById('population-current').textContent = population.current;
            document.getElementById('happiness-level').textContent = Math.floor(happiness) + '%';
            document.getElementById('buildings-count').textContent = buildingsCount;
            document.getElementById('military-power').textContent = Math.floor(militaryPower);
        }
        
        function updateProductionDisplay() {
            const container = document.getElementById('production-display');
            const production = gameEngine.calculateProduction();
            
            container.innerHTML = Object.keys(RESOURCES_CONFIG).map(resource => {
                const config = RESOURCES_CONFIG[resource];
                const rate = production[resource] || 0;
                const rateClass = rate > 0 ? 'positive' : rate < 0 ? 'negative' : '';
                
                return `
                    <div class="production-item">
                        <div class="production-resource">
                            <span>${config.icon}</span>
                            <span>${config.name}</span>
                        </div>
                        <div class="production-rate ${rateClass}">
                            ${rate > 0 ? '+' : ''}${Math.floor(rate)}/h
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateStorageDisplay() {
            const container = document.getElementById('storage-display');
            const gameState = gameEngine.getGameState();
            const capacity = gameEngine.calculateStorageCapacity('main');
            
            container.innerHTML = Object.keys(RESOURCES_CONFIG).map(resource => {
                const config = RESOURCES_CONFIG[resource];
                const current = gameState.resources[resource] || 0;
                const max = capacity[resource] || 1000;
                const percentage = Math.min(100, (current / max) * 100);
                
                return `
                    <div class="storage-item">
                        <div class="storage-header">
                            <div class="storage-resource">
                                <span>${config.icon}</span>
                                <span>${config.name}</span>
                            </div>
                            <div class="storage-amount">
                                ${Math.floor(current)} / ${Math.floor(max)}
                            </div>
                        </div>
                        <div class="storage-bar">
                            <div class="storage-bar-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateConstructionQueue() {
            const container = document.getElementById('construction-queue');
            const gameState = gameEngine.getGameState();
            const queue = gameState.constructionQueue || [];
            
            if (queue.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--roman-marble); padding: 1rem;">Aucune construction en cours</div>';
                return;
            }
            
            container.innerHTML = queue.map(item => {
                const config = BUILDINGS_CONFIG[item.type];
                const progress = ((Date.now() - item.startTime) / item.duration) * 100;
                const remainingTime = Math.max(0, item.startTime + item.duration - Date.now());
                const timeText = formatTime(remainingTime);
                
                return `
                    <div class="queue-item">
                        <div class="queue-item-header">
                            <div class="queue-item-name">
                                <span>${config.icon}</span>
                                <span>${config.name} Niv. ${item.level}</span>
                            </div>
                            <div class="queue-item-time">${timeText}</div>
                        </div>
                        <div class="queue-progress">
                            <div class="queue-progress-bar" style="width: ${Math.min(100, progress)}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateBuildingSlots() {
            const gameState = gameEngine.getGameState();
            const city = gameState.cities.main;
            
            buildingSlots.forEach((slot, index) => {
                const building = city.buildings[`slot_${index}`];
                const constructionItem = gameState.constructionQueue?.find(item => item.slotId === `slot_${index}`);
                
                if (constructionItem) {
                    slot.classList.add('constructing');
                    const progress = ((Date.now() - constructionItem.startTime) / constructionItem.duration) * 100;
                    const progressBar = slot.querySelector('.building-progress-bar');
                    if (progressBar) {
                        progressBar.style.width = Math.min(100, progress) + '%';
                    }
                } else {
                    slot.classList.remove('constructing');
                }
            });
        }
        
        // Actions rapides
        function quickCollectTaxes() {
            const gameState = gameEngine.getGameState();
            const population = gameEngine.calculatePopulation();
            const taxAmount = Math.floor(population.current * 2); // 2 or par citoyen
            
            gameState.resources.gold += taxAmount;
            uiManager.showNotification('Tributa Collecta', `+${taxAmount} üí∞ or collect√© des citoyens!`, 'success');
        }
        
        function quickRecruitUnits() {
            // Rediriger vers la page militaire
            window.location.href = '../Militaire/Caserne.html';
        }
        
        function quickBoostProduction() {
            const cost = 500; // Co√ªt en or
            const gameState = gameEngine.getGameState();
            
            if (gameState.resources.gold >= cost) {
                gameState.resources.gold -= cost;
                // Appliquer un boost temporaire (sera g√©r√© par le syst√®me d'√©v√©nements)
                uiManager.showNotification('Acceleratio', 'Production acc√©l√©r√©e pendant 1 heure! ‚ö°', 'success');
            } else {
                uiManager.showNotification('Erreur', 'Or insuffisant (500 üí∞ requis)', 'error');
            }
        }
        
        function quickCelebrateFestival() {
            const cost = 300; // Co√ªt en or et vin
            const gameState = gameEngine.getGameState();
            
            if (gameState.resources.gold >= cost && gameState.resources.wine >= 50) {
                gameState.resources.gold -= cost;
                gameState.resources.wine -= 50;
                // Augmenter temporairement le bonheur
                uiManager.showNotification('Festum Celebratum', 'Festival organis√©! Bonheur des citoyens +20! üé≠', 'success');
            } else {
                uiManager.showNotification('Erreur', 'Ressources insuffisantes (300 üí∞ + 50 üçá)', 'error');
            }
        }
        
        // Utilitaires
        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            
            if (hours > 0) {
                return `${hours}h ${minutes % 60}m`;
            } else if (minutes > 0) {
                return `${minutes}m ${seconds % 60}s`;
            } else {
                return `${seconds}s`;
            }
        }
        
        // Conseils de d√©veloppement
        function showDevelopmentTips() {
            const tips = [
                "üèõÔ∏è Construisez un Forum pour augmenter votre population maximale",
                "üè™ Les Entrep√¥ts augmentent votre capacit√© de stockage",
                "üçá Les Tavernes am√©liorent le bonheur de vos citoyens",
                "‚öîÔ∏è Une Caserne est n√©cessaire pour recruter des unit√©s",
                "üî¨ L'Acad√©mie permet de rechercher de nouvelles technologies",
                "üí∞ La Monnaie Imp√©riale g√©n√®re de l'or automatiquement"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            uiManager.showNotification('Consilium Aedificandi', randomTip, 'info', 8000);
        }
        
        // Afficher un conseil au chargement
        setTimeout(showDevelopmentTips, 3000);
        
        // Raccourcis clavier
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey) {
                switch(e.key) {
                    case 'T':
                        e.preventDefault();
                        quickCollectTaxes();
                        break;
                    case 'R':
                        e.preventDefault();
                        quickRecruitUnits();
                        break;
                    case 'B':
                        e.preventDefault();
                        quickBoostProduction();
                        break;
                    case 'F':
                        e.preventDefault();
                        quickCelebrateFestival();
                        break;
                }
            }
        });
    </script>
</body>
</html>